# [M1-D1.2] Add block reason input to card component

## Deliverable: Users can add context explaining why a card is blocked

### Context
**PRD:** `docs/project/PRD/active/PRD-phase2-enhanced-ux.md` — M1: Card Blocking UI, D1.2

When cards are blocked, users often need to capture why—waiting on external dependency, technical issue, etc. This deliverable adds an optional text field to capture and display the block reason, providing context during simulation review.

### Traceability
- **PRD Section:** M1-D1.2 "Block reason input (optional)"
- **Functional Requirement:** Text field to capture why card is blocked, displayed on card
- **Success Criteria:** SC-1 "Users can add context to blocked cards"

### Acceptance Criteria
- [ ] Text input field appears when card is blocked
- [ ] Input field hidden when card is not blocked
- [ ] Block reason displays on card below "BLOCKED!" badge
- [ ] Block reason persists in card state (`blockReason?: string`)
- [ ] Block reason saved/loaded with context export/import
- [ ] Empty reason is valid (field is optional)
- [ ] Reason can be edited while card remains blocked

### Edge Case Scenarios
- Enter very long reason (500+ characters) → Text truncates in display with ellipsis, full text in tooltip
- Enter reason then unblock card → Reason is cleared from state
- Enter reason with special characters (quotes, HTML) → Characters display correctly, no XSS
- Block card during policy run, enter reason → Reason persists after policy completes
- Import context with blocked card + reason → Reason displays correctly

### Implementation Guidelines
- Extend Card interface in `src/App.tsx` to add `blockReason?: string`
- Modify `src/components/Card.tsx` to show input field conditionally
- Add new `onBlockReasonChange?: (cardId: string, reason: string) => void` prop
- Input should use `e.stopPropagation()` to prevent card click behavior
- Display reason in a `<div className="card-block-reason">` below the BLOCKED badge
- Update `KanbanState` interface to include `blockReason` in Card type
- CSS: Max-width with text-overflow ellipsis, tooltip for full text

### Embedded Reasoning
**Why:** Block reasons provide context for simulation review and teaching—understanding why work stalls is as important as knowing it's stalled.
**What:** An optional text input that captures and displays the reason a card is blocked.
**How:** Conditionally render an input field when `isBlocked` is true, with a callback to update the reason in parent state.

### Testing Strategy
- **Unit:** Test input field renders only when `isBlocked` is true
- **Unit:** Test `onBlockReasonChange` called with correct cardId and reason
- **Unit:** Test reason displays in card when provided
- **Integration:** Test reason persists through save/load cycle
- **Edge Cases:** Test long text truncation, special character handling

### Dependencies
Depends on M1-D1.1 (block toggle must exist before adding reason input)

### Verification
1. Block a card → Input field appears
2. Enter "Waiting for API specification" → Reason displays on card
3. Unblock card → Input field and reason disappear
4. Save context, reload, import → Block reason restored on blocked cards
5. Run `npm test` → All Card component tests pass
