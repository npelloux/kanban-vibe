# [M4-D4.2] Add auto-save status indicator to navigation bar

## Deliverable: Visual indicator showing save status (Saved, Saving..., Unsaved changes)

### Context
**PRD:** `docs/project/PRD/active/PRD-phase2-enhanced-ux.md` — M4: Auto-Save with localStorage, D4.2

While auto-save happens invisibly, users need confidence their work is preserved. This deliverable adds a status indicator showing whether changes are saved, currently saving, or pending.

### Traceability
- **PRD Section:** M4-D4.2 "Auto-save indicator"
- **Functional Requirement:** Status indicator with states (Saved, Saving..., Unsaved changes), last saved timestamp
- **Success Criteria:** SC-4 "Users know when data is saved"

### Acceptance Criteria
- [ ] Indicator appears in navigation bar
- [ ] Shows "Saved" with checkmark when state matches localStorage
- [ ] Shows "Saving..." with spinner during debounce/save
- [ ] Shows "Unsaved changes" with warning icon when state differs from saved
- [ ] Shows last saved timestamp (relative time: "2 seconds ago", "1 minute ago")
- [ ] Timestamp updates in real-time
- [ ] Indicator uses appropriate colors (green=saved, yellow=saving, orange=unsaved)

### Edge Case Scenarios
- Page just loaded with saved state → Shows "Saved" immediately
- First change after page load → Shows "Unsaved changes", then "Saving...", then "Saved"
- Rapid changes → "Unsaved changes" persists until debounce completes
- Save fails (quota exceeded) → Shows "Save failed" with red styling
- localStorage disabled → Shows "Auto-save unavailable"
- Timestamp crosses minute boundary → Updates from "59 seconds ago" to "1 minute ago"

### Implementation Guidelines
- Create `src/components/AutoSaveIndicator.tsx` component
- Integrate with useLocalStorageSync hook from M4-D4.1:
```typescript
interface SaveStatus {
  status: 'saved' | 'saving' | 'unsaved' | 'error' | 'unavailable';
  lastSavedAt: number | null;
  error?: string;
}
```
- Use `useState` to track save status
- Use `useEffect` with interval for relative timestamp updates (every 10s)
- Position in nav bar near day counter
- Icons: checkmark (saved), spinner (saving), warning triangle (unsaved), X (error)
- CSS classes: `.save-status-saved`, `.save-status-saving`, `.save-status-unsaved`, `.save-status-error`

### Embedded Reasoning
**Why:** Even with invisible persistence, users need feedback loop to trust the system is working.
**What:** Status indicator with three main states plus error handling, with relative timestamp.
**How:** Component that observes save hook state, renders appropriate icon/text/color.

### Testing Strategy
- **Unit:** Test indicator shows "Saved" when status is saved
- **Unit:** Test indicator shows "Saving..." when status is saving
- **Unit:** Test indicator shows "Unsaved changes" when status is unsaved
- **Unit:** Test relative timestamp formatting
- **Unit:** Test error state display
- **Integration:** Test status transitions during save cycle
- **Edge Cases:** Test localStorage unavailable, test save failure

### Dependencies
Depends on M4-D4.1 (Automatic state persistence)

### Verification
1. Load page with saved state → Shows "Saved" with timestamp
2. Add a card → Shows "Unsaved changes" → "Saving..." → "Saved"
3. Wait 1 minute → Timestamp shows "1 minute ago"
4. Fill localStorage quota → Shows "Save failed" error state
5. Run `npm test` → All indicator tests pass
