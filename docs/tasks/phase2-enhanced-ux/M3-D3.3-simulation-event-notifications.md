# [M3-D3.3] Add simulation event notifications

## Deliverable: Toast notifications for key simulation events (card completed, policy started/completed, day advanced)

### Context
**PRD:** `docs/project/PRD/active/PRD-phase2-enhanced-ux.md` — M3: Notification System, D3.3

Beyond error notifications, users benefit from positive feedback during simulation. This deliverable adds notifications for key events like card completions and policy execution status.

### Traceability
- **PRD Section:** M3-D3.3 "Simulation event notifications"
- **Functional Requirement:** Notifications for card completed, policy started/completed, day advanced
- **Success Criteria:** SC-3 "Key events provide feedback"

### Acceptance Criteria
- [ ] Success toast when card reaches Done: "Card {ID} completed! Lead time: {N} days"
- [ ] Info toast when policy starts: "Running {PolicyName} policy for {N} days..."
- [ ] Success toast when policy completes: "Policy complete. {N} cards completed, {M} days simulated"
- [ ] Info toast on day advance (optional, user-configurable): "Day {N}"
- [ ] Notifications can be toggled on/off in settings
- [ ] Card completion notifications show during policy execution (batched)

### Edge Case Scenarios
- 5 cards complete on same day → Show summary: "5 cards completed on Day {N}"
- Policy cancelled mid-execution → Info toast: "Policy cancelled after {N} days"
- No cards complete during policy → Summary shows "0 cards completed"
- Day notification disabled → No toast on day advance
- Card completes while notifications disabled → No toast shown

### Implementation Guidelines
- Add notification calls in `src/App.tsx`:
  - In day advancement logic when card moves to 'done'
  - In policy runner start/complete/cancel handlers
- Create notification settings in state:
```typescript
interface NotificationSettings {
  showCardCompletions: boolean;  // default: true
  showPolicyEvents: boolean;     // default: true
  showDayAdvance: boolean;       // default: false
}
```
- Batch card completions during policy: collect completions, show summary at end
- Calculate lead time: `completionDay - startDay`
- Use toast types: 'success' for completions, 'info' for policy status

### Embedded Reasoning
**Why:** Positive feedback reinforces learning—knowing when cards complete helps users understand flow.
**What:** Notifications for card completions, policy status, and optionally day advancement.
**How:** Add toast calls at appropriate points in state update logic, with batching for policy execution.

### Testing Strategy
- **Unit:** Test card completion notification message format
- **Unit:** Test lead time calculation in notification
- **Unit:** Test policy start/complete message format
- **Unit:** Test batching of multiple completions
- **Integration:** Test notifications during manual day advance
- **Integration:** Test notifications during policy execution
- **Edge Cases:** Test notifications disabled, test cancel during policy

### Dependencies
Depends on M3-D3.1 (Toast notification component)

### Verification
1. Move card through all stages to Done → Success toast with lead time
2. Start policy → Info toast shows policy name and day count
3. Policy completes → Success toast with completion summary
4. Disable card completion notifications → No toast when card completes
5. Run `npm test` → All event notification tests pass
