# [M3-D3.2] Add WIP limit violation notifications

## Deliverable: Toast notifications explain why card moves are blocked by WIP limits

### Context
**PRD:** `docs/project/PRD/active/PRD-phase2-enhanced-ux.md` — M3: Notification System, D3.2

Currently, WIP limit violations either fail silently (during policy execution) or show browser alerts (during manual clicks). This deliverable replaces these with toast notifications that explain why moves are blocked.

### Traceability
- **PRD Section:** M3-D3.2 "WIP limit violation notifications"
- **Functional Requirement:** Trigger notification when move blocked by max or min WIP
- **Success Criteria:** SC-3 "Users understand why moves are blocked"

### Acceptance Criteria
- [ ] Max WIP violation shows warning toast: "Cannot move card: {Column} would exceed max WIP limit of {N}"
- [ ] Min WIP violation shows warning toast: "Cannot move card: {Column} would go below min WIP limit of {N}"
- [ ] Toast includes column name in human-readable format (e.g., "Red Active" not "redActive")
- [ ] Notification triggers on manual card click
- [ ] Notification triggers during automatic stage progression
- [ ] Notification triggers during policy execution
- [ ] Replace existing `alert()` calls with toast notifications

### Edge Case Scenarios
- Multiple cards blocked in same day → Each shows separate notification (may trigger max toast limit)
- Same violation repeated rapidly → Each occurrence shows toast (user feedback on each attempt)
- Policy blocks many cards → Show summary notification: "Policy blocked {N} cards due to WIP limits"
- Max and min violation on same action → Show the relevant violation message
- WIP limit of 0 (no limit) → No violation possible, no notification

### Implementation Guidelines
- Modify `src/App.tsx` to use toast system instead of `alert()` calls
- Replace `alert()` in `handleCardClick` (lines 526-534, 548-556, 570-578)
- Add toast calls in `handleNextDay` where WIP violations are logged
- Create column name mapping function:
```typescript
const getColumnDisplayName = (stage: string): string => {
  const names: Record<string, string> = {
    'options': 'Options',
    'red-active': 'Red Active',
    'red-finished': 'Red Finished',
    'blue-active': 'Blue Active',
    'blue-finished': 'Blue Finished',
    'green': 'Green Activities',
    'done': 'Done'
  };
  return names[stage] || stage;
};
```
- Use toast type `'warning'` for WIP violations
- For policy execution, batch violations and show summary at end

### Embedded Reasoning
**Why:** "Explain, don't just prevent" is a Phase 2 design principle. Users learning flow concepts need to understand why actions are blocked.
**What:** Toast notifications that clearly state which WIP limit was violated and by how much.
**How:** Replace alert() calls with toast.addToast() calls, formatting messages with column names and limit values.

### Testing Strategy
- **Unit:** Test max WIP violation message format
- **Unit:** Test min WIP violation message format
- **Unit:** Test column name display formatting
- **Integration:** Test notification appears when clicking blocked card
- **Integration:** Test notification appears during day advancement
- **Integration:** Test batch notification during policy execution
- **Edge Cases:** Test rapid violations, test limit of 0

### Dependencies
Depends on M3-D3.1 (Toast notification component)

### Verification
1. Set Red Active max WIP to 1, add card, click second card in Options → Warning toast shows
2. Set Options min WIP to 2, add 2 cards, click one → Warning toast shows
3. Run policy with restrictive WIP limits → Summary notification at end
4. No `alert()` calls remain in codebase for WIP violations
5. Run `npm test` → All WIP notification tests pass
